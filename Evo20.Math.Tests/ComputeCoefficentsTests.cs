using Microsoft.VisualStudio.TestTools.UnitTesting;
using Evo20.Sensors;

namespace Evo20.Math.Tests
{
    [TestClass]
    public class ComputeCoefficentsTests
    {
        [TestMethod]
        public void DLYModelVectors_CorrectVectors()
        {
            var etalonDoubles = new[]
            {
                new[] {0, 9.807, 0},
                new[] {-2.538238375, 9.472834578, 0},
                new[] {-4.9035, 8.493111135, 0},
                new[] {-6.934596203, 6.934596203, 0},
                new[] {-8.493111135, 4.9035, 0},
                new[] {-9.472834578, 2.538238375, 0},
                new[] {-9.807, 6.00752E-16, 0},
                new[] {-9.472834578, -2.538238375, 0},
                new[] {-8.493111135, -4.9035, 0},
                new[] {-6.934596203, -6.934596203, 0},
                new[] {-4.9035, -8.493111135, 0},
                new[] {-2.538238375, -9.472834578, 0},
                new[] {-1.2015E-15, -9.807, 0},
                new[] {2.538238375, -9.472834578, 0},
                new[] {4.9035, -8.493111135, 0},
                new[] {6.934596203, -6.934596203, 0},
                new[] {8.493111135, -4.9035, 0},
                new[] {9.472834578, -2.538238375, 0},
                new[] {9.807, -1.80225E-15, 0},
                new[] {9.472834578, 2.538238375, 0},
                new[] {8.493111135, 4.9035, 0},
                new[] {6.934596203, 6.934596203, 0},
                new[] {4.9035, 8.493111135, 0},
                new[] {2.538238375, 9.472834578, 0},
                new[] {0, 9.807, 0},
                new[] {-1.55486E-16, 9.472834578, 2.538238375},
                new[] {-3.00376E-16, 8.493111135, 4.9035},
                new[] {-4.24795E-16, 6.934596203, 6.934596203},
                new[] {-5.20266E-16, 4.9035, 8.493111135},
                new[] {-5.80281E-16, 2.538238375, 9.472834578},
                new[] {-6.00752E-16, 6.00752E-16, 9.807},
                new[] {-5.80281E-16, -2.538238375, 9.472834578},
                new[] {-5.20266E-16, -4.9035, 8.493111135},
                new[] {-4.24795E-16, -6.934596203, 6.934596203},
                new[] {-3.00376E-16, -8.493111135, 4.9035},
                new[] {-1.55486E-16, -9.472834578, 2.538238375},
                new[] {-7.3601E-32, -9.807, 1.2015E-15},
                new[] {1.55486E-16, -9.472834578, -2.538238375},
                new[] {3.00376E-16, -8.493111135, -4.9035},
                new[] {4.24795E-16, -6.934596203, -6.934596203},
                new[] {5.20266E-16, -4.9035, -8.493111135},
                new[] {5.80281E-16, -2.538238375, -9.472834578},
                new[] {6.00752E-16, -1.80225E-15, -9.807},
                new[] {5.80281E-16, 2.538238375, -9.472834578},
                new[] {5.20266E-16, 4.9035, -8.493111135},
                new[] {4.24795E-16, 6.934596203, -6.934596203},
                new[] {3.00376E-16, 8.493111135, -4.9035},
                new[] {1.55486E-16, 9.472834578, -2.538238375},
                new[] {-9.807, 6.00752E-16, 0},
                new[] {-9.472834578, 6.00752E-16, -2.538238375},
                new[] {-8.493111135, 6.00752E-16, -4.9035},
                new[] {-6.934596203, 6.00752E-16, -6.934596203},
                new[] {-4.9035, 6.00752E-16, -8.493111135},
                new[] {-2.538238375, 6.00752E-16, -9.472834578},
                new[] {-6.00752E-16, 6.00752E-16, -9.807},
                new[] {2.538238375, 6.00752E-16, -9.472834578},
                new[] {4.9035, 6.00752E-16, -8.493111135},
                new[] {6.934596203, 6.00752E-16, -6.934596203},
                new[] {8.493111135, 6.00752E-16, -4.9035},
                new[] {9.472834578, 6.00752E-16, -2.538238375},
                new[] {9.807, 6.00752E-16, -1.2015E-15},
                new[] {9.472834578, 6.00752E-16, 2.538238375},
                new[] {8.493111135, 6.00752E-16, 4.9035},
                new[] {6.934596203, 6.00752E-16, 6.934596203},
                new[] {4.9035, 6.00752E-16, 8.493111135},
                new[] {2.538238375, 6.00752E-16, 9.472834578},
                new[] {1.80225E-15, 6.00752E-16, 9.807},
                new[] {-2.538238375, 6.00752E-16, 9.472834578},
                new[] {-4.9035, 6.00752E-16, 8.493111135},
                new[] {-6.934596203, 6.00752E-16, 6.934596203},
                new[] {-8.493111135, 6.00752E-16, 4.9035},
                new[] {-9.472834578, 6.00752E-16, 2.538238375}
            };
            var profile = new[]
            {
                new Position (),
                new Position (15),
                new Position (30),
                new Position (45),
                new Position (60),
                new Position (75),
                new Position (90),
                new Position (105),
                new Position (120),
                new Position (135),
                new Position (150),
                new Position (165),
                new Position (180),
                new Position (195),
                new Position (210),
                new Position (225),
                new Position (240),
                new Position (255),
                new Position (270),
                new Position (285),
                new Position (300),
                new Position (315),
                new Position (330),
                new Position (345),
                new Position (0   ,-90 ),
                new Position (15  ,-90 ),
                new Position (30  ,-90 ),
                new Position (45  ,-90 ),
                new Position (60  ,-90 ),
                new Position (75  ,-90 ),
                new Position (90  ,-90 ),
                new Position (105 ,-90 ),
                new Position (120 ,-90 ),
                new Position (135 ,-90 ),
                new Position (150 ,-90 ),
                new Position (165 ,-90 ),
                new Position (180 ,-90 ),
                new Position (195 ,-90 ),
                new Position (210 ,-90 ),
                new Position (225 ,-90 ),
                new Position (240 ,-90 ),
                new Position (255 ,-90 ),
                new Position (270 ,-90 ),
                new Position (285 ,-90 ),
                new Position (300 ,-90 ),
                new Position (315 ,-90 ),
                new Position (330 ,-90 ),
                new Position (345 ,-90 ),
                new Position (90),
                new Position (90  ,15  ),
                new Position (90  ,30  ),
                new Position (90  ,45  ),
                new Position (90  ,60  ),
                new Position (90  ,75  ),
                new Position (90  ,90  ),
                new Position (90  ,105 ),
                new Position (90  ,120 ),
                new Position (90  ,135 ),
                new Position (90  ,150 ),
                new Position (90  ,165 ),
                new Position (90  ,180 ),
                new Position (90  ,195 ),
                new Position (90  ,210 ),
                new Position (90  ,225 ),
                new Position (90  ,240 ),
                new Position (90  ,255 ),
                new Position (90  ,270 ),
                new Position (90  ,285 ),
                new Position (90  ,300 ),
                new Position (90  ,315 ),
                new Position (90  ,330 ),
                new Position (90  ,345 ),


            };
            var testResult = CalculatorCoefficients.DLYModelVectors(profile);

            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 5);
        }

        [TestMethod]
        public void DLYModelVectors_CorrectVectors2()
        {
            var etalonDoubles = new[]
            {
                new[] {0, 9.807, 0}, new[] {-2.538238375, 9.472834578, 0},
                new[] {-4.9035, 8.493111135, 0},
                new[] {-6.934596203, 6.934596203, 0},
                new[] {-8.493111135, 4.9035, 0},
                new[] {-9.472834578, 2.538238375, 0},
                new[] {-9.807, 6.00752E-16, 0},
                new[] {-9.472834578, -2.538238375, 0},
                new[] {-8.493111135, -4.9035, 0},
                new[] {-6.934596203, -6.934596203, 0},
                new[] {-4.9035, -8.493111135, 0},
                new[] {-2.538238375, -9.472834578, 0},
                new[] {-1.2015E-15, -9.807, 0},
                new[] {2.538238375, -9.472834578, 0},
                new[] {4.9035, -8.493111135, 0},
                new[] {6.934596203, -6.934596203, 0},
                new[] {8.493111135, -4.9035, 0},
                new[] {9.472834578, -2.538238375, 0},
                new[] {9.807, -1.80225E-15, 0},
                new[] {9.472834578, 2.538238375, 0},
                new[] {8.493111135, 4.9035, 0},
                new[] {6.934596203, 6.934596203, 0},
                new[] {4.9035, 8.493111135, 0},
                new[] {2.538238375, 9.472834578, 0},
                new[] {0, 9.807, 0},
                new[] {-1.55486E-16, 9.472834578, -2.538238375},
                new[] {-3.00376E-16, 8.493111135, -4.9035},
                new[] {-4.24795E-16, 6.934596203, -6.934596203},
                new[] {-5.20266E-16, 4.9035, -8.493111135},
                new[] {-5.80281E-16, 2.538238375, -9.472834578},
                new[] {-6.00752E-16, 6.00752E-16, -9.807},
                new[] {-5.80281E-16, -2.538238375, -9.472834578},
                new[] {-5.20266E-16, -4.9035, -8.493111135},
                new[] {-4.24795E-16, -6.934596203, -6.934596203},
                new[] {-3.00376E-16, -8.493111135, -4.9035},
                new[] {-1.55486E-16, -9.472834578, -2.538238375},
                new[] {-7.3601E-32, -9.807, -1.2015E-15},
                new[] {1.55486E-16, -9.472834578, 2.538238375},
                new[] {3.00376E-16, -8.493111135, 4.9035},
                new[] {4.24795E-16, -6.934596203, 6.934596203},
                new[] {5.20266E-16, -4.9035, 8.493111135},
                new[] {5.80281E-16, -2.538238375, 9.472834578},
                new[] {6.00752E-16, -1.80225E-15, 9.807},
                new[] {5.80281E-16, 2.538238375, 9.472834578},
                new[] {5.20266E-16, 4.9035, 8.493111135},
                new[] {4.24795E-16, 6.934596203, 6.934596203},
                new[] {3.00376E-16, 8.493111135, 4.9035},
                new[] {1.55486E-16, 9.472834578, 2.538238375},
                new[] {6.00752E-16, 6.00752E-16, -9.807},
                new[] {2.538238375, 6.00752E-16, -9.472834578},
                new[] {4.9035, 6.00752E-16, -8.493111135},
                new[] {6.934596203, 6.00752E-16, -6.934596203},
                new[] {8.493111135, 6.00752E-16, -4.9035},
                new[] {9.472834578, 6.00752E-16, -2.538238375},
                new[] {9.807, 6.00752E-16, 0},
                new[] {9.472834578, 6.00752E-16, 2.538238375},
                new[] {8.493111135, 6.00752E-16, 4.9035},
                new[] {6.934596203, 6.00752E-16, 6.934596203},
                new[] {4.9035, 6.00752E-16, 8.493111135},
                new[] {2.538238375, 6.00752E-16, 9.472834578},
                new[] {6.00752E-16, 6.00752E-16, 9.807},
                new[] {-2.538238375, 6.00752E-16, 9.472834578},
                new[] {-4.9035, 6.00752E-16, 8.493111135},
                new[] {-6.934596203, 6.00752E-16, 6.934596203},
                new[] {-8.493111135, 6.00752E-16, 4.9035},
                new[] {-9.472834578, 6.00752E-16, 2.538238375},
                new[] {-9.807, 6.00752E-16, 1.2015E-15},
                new[] {-9.472834578, 6.00752E-16, -2.538238375},
                new[] {-8.493111135, 6.00752E-16, -4.9035},
                new[] {-6.934596203, 6.00752E-16, -6.934596203},
                new[] {-4.9035, 6.00752E-16, -8.493111135},
                new[] {-2.538238375, 6.00752E-16, -9.472834578}
            };

            var profile = new[]
            {
                new Position(), new Position(15), new Position(30), new Position(45), new Position(60),
                new Position(75), new Position(90), new Position(105), new Position(120), new Position(135),
                new Position(150), new Position(165), new Position(180), new Position(195), new Position(210),
                new Position(225), new Position(240), new Position(255), new Position(270), new Position(285),
                new Position(300), new Position(315), new Position(330), new Position(345), new Position(0, 90),
                new Position(15, 90), new Position(30, 90), new Position(45, 90), new Position(60, 90),
                new Position(75, 90), new Position(90, 90), new Position(105, 90), new Position(120, 90),
                new Position(135, 90), new Position(150, 90), new Position(165, 90), new Position(180, 90),
                new Position(195, 90), new Position(210, 90), new Position(225, 90), new Position(240, 90),
                new Position(255, 90), new Position(270, 90), new Position(285, 90), new Position(300, 90),
                new Position(315, 90), new Position(330, 90), new Position(345, 90), new Position(-90, -90),
                new Position(-90, -75), new Position(-90, -60), new Position(-90, -45), new Position(-90, -30),
                new Position(-90, -15), new Position(-90), new Position(-90, 15), new Position(-90, 30),
                new Position(-90, 45), new Position(-90, 60), new Position(-90, 75), new Position(-90, 90),
                new Position(-90, 105), new Position(-90, 120), new Position(-90, 135), new Position(-90, 150),
                new Position(-90, 165), new Position(-90, 180), new Position(-90, 195), new Position(-90, 210),
                new Position(-90, 225), new Position(-90, 240), new Position(-90, 255),
            };
            var testResult = CalculatorCoefficients.DLYModelVectors(profile);
            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 5);
        }

        [TestMethod]
        public void OneCompute_CorrectAnswer()
        {
            var etalonDoubles = new[]
            {
                new[] {-0.098074961, -0.025930347, 0.075644549},
                new[] {-243.4884653, -0.839549077, 2.250266815},
                new[] {0.270378544, 243.7211154, -0.007695472},
                new[] {1.853253743, 0.188496032, -243.9743518}

            };

            var a = new[]
            {
                new[] {1, -0.000337988, 0.040348914, 0.000323314},
                new[] {1, 0.010081262, 0.039011172, 0.000420023},
                new[] {1, 0.019787188, 0.035017074, 0.000501387},
                new[] {1, 0.028117552, 0.028657022, 0.000581891},
                new[] {1, 0.034510042, 0.020343515, 0.000636167},
                new[] {1, 0.038516317, 0.010647424, 0.000677287},
                new[] {1, 0.039877998, 0.000245623, 0.000690183},
                new[] {1, 0.038496805, -0.010172113, 0.000678051},
                new[] {1, 0.034463901, -0.019887196, 0.000645551},
                new[] {1, 0.028052987, -0.028245245, 0.00058085},
                new[] {1, 0.019703594, -0.034680603, 0.000500481},
                new[] {1, 0.00998844, -0.038736987, 0.000413689},
                new[] {1, -0.000430377, -0.040145553, 0.000318389},
                new[] {1, -0.010860944, -0.038802722, 0.000222373},
                new[] {1, -0.020569559, -0.034816788, 0.000130296},
                new[] {1, -0.028910475, -0.028448261, 5.81E-05},
                new[] {1, -0.035308127, -0.020132421, -6.35E-06},
                new[] {1, -0.039325439, -0.01043991, -4.57E-05},
                new[] {1, -0.040681987, -2.88E-05, -6.21E-05},
                new[] {1, -0.039294659, 0.010381751, -4.93E-05},
                new[] {1, -0.035261926, 0.020102095, -1.44E-05},
                new[] {1, -0.02884825, 0.028453005, 4.11E-05},
                new[] {1, -0.020496198, 0.034877489, 0.000123037},
                new[] {1, -0.010778023, 0.038931823, 0.000211728},
                new[] {1, -0.000356071, 0.040331848, 0.00030561},
                new[] {1, -0.000270521, 0.038952369, 0.010710118},
                new[] {1, -0.000205302, 0.034926117, 0.020403525},
                new[] {1, -0.000151157, 0.028530215, 0.028728719},
                new[] {1, -0.000113451, 0.020191912, 0.035123056},
                new[] {1, -9.42E-05, 0.010483023, 0.039135832},
                new[] {1, -9.40E-05, 7.27E-05, 0.040509493},
                new[] {1, -0.000117165, -0.010343457, 0.039136201},
                new[] {1, -0.000158823, -0.020044048, 0.035113675},
                new[] {1, -0.000211658, -0.028376941, 0.028720384},
                new[] {1, -0.000283747, -0.034765339, 0.020398694},
                new[] {1, -0.000366835, -0.038777774, 0.010708646},
                new[] {1, -0.000444213, -0.040140031, 0.000303691},
                new[] {1, -0.000519741, -0.038760503, -0.010100948},
                new[] {1, -0.000587818, -0.034734473, -0.019788908},
                new[] {1, -0.000644751, -0.028336883, -0.028117792},
                new[] {1, -0.000683029, -0.019995256, -0.034512367},
                new[] {1, -0.000705548, -0.010284543, -0.038529021},
                new[] {1, -0.000705633, 0.000134457, -0.039896058},
                new[] {1, -0.000687119, 0.010547999, -0.038530647},
                new[] {1, -0.000644171, 0.020246484, -0.034513573},
                new[] {1, -0.000586007, 0.028568664, -0.028123489},
                new[] {1, -0.000520372, 0.034962051, -0.019797197},
                new[] {1, -0.000436214, 0.038975362, -0.010101447},
                new[] {1, -9.50E-05, 8.24E-05, 0.040501126},
                new[] {1, -0.010526035, 4.52E-05, 0.039036626},
                new[] {1, -0.020272982, 1.87E-05, 0.034927392},
                new[] {1, -0.028669408, -6.38E-06, 0.028461492},
                new[] {1, -0.035136322, -2.02E-05, 0.020081347},
                new[] {1, -0.03924328, -2.78E-05, 0.010348374},
                new[] {1, -0.040688387, -2.32E-05, -6.82E-05},
                new[] {1, -0.03939535, -9.95E-06, -0.010457656},
                new[] {1, -0.035444171, 9.32E-06, -0.020111894},
                new[] {1, -0.029100625, 3.55E-05, -0.028384086},
                new[] {1, -0.020810614, 6.96E-05, -0.034703478},
                new[] {1, -0.011122935, 0.000102059, -0.038623468},
                new[] {1, -0.000707995, 0.00013944, -0.03990275},
                new[] {1, 0.009730253, 0.000175506, -0.038433663},
                new[] {1, 0.019473794, 0.00020745, -0.034325722},
                new[] {1, 0.027860116, 0.000232233, -0.027861535},
                new[] {1, 0.034320854, 0.000245636, -0.019479028},
                new[] {1, 0.03842191, 0.000250366, -0.009752113},
                new[] {1, 0.039872276, 0.000252507, 0.000663576},
                new[] {1, 0.038573048, 0.00023698, 0.011055806},
                new[] {1, 0.034625553, 0.000218661, 0.020716708},
                new[] {1, 0.028289808, 0.000191309, 0.02898349},
                new[] {1, 0.019999726, 0.000155568, 0.035297026},
                new[] {1, 0.010316486, 0.000118897, 0.039225991}
            };

            var profile = new[]
            {
                new Position(), new Position(15), new Position(30), new Position(45), new Position(60),
                new Position(75), new Position(90), new Position(105), new Position(120), new Position(135),
                new Position(150), new Position(165), new Position(180), new Position(195), new Position(210),
                new Position(225), new Position(240), new Position(255), new Position(270), new Position(285),
                new Position(300), new Position(315), new Position(330), new Position(345), new Position(0, 90),
                new Position(15, 90), new Position(30, 90), new Position(45, 90), new Position(60, 90),
                new Position(75, 90), new Position(90, 90), new Position(105, 90), new Position(120, 90),
                new Position(135, 90), new Position(150, 90), new Position(165, 90), new Position(180, 90),
                new Position(195, 90), new Position(210, 90), new Position(225, 90), new Position(240, 90),
                new Position(255, 90), new Position(270, 90), new Position(285, 90), new Position(300, 90),
                new Position(315, 90), new Position(330, 90), new Position(345, 90), new Position(-90, -90),
                new Position(-90, -75), new Position(-90, -60), new Position(-90, -45), new Position(-90, -30),
                new Position(-90, -15), new Position(-90), new Position(-90, 15), new Position(-90, 30),
                new Position(-90, 45), new Position(-90, 60), new Position(-90, 75), new Position(-90, 90),
                new Position(-90, 105), new Position(-90, 120), new Position(-90, 135), new Position(-90, 150),
                new Position(-90, 165), new Position(-90, 180), new Position(-90, 195), new Position(-90, 210),
                new Position(-90, 225), new Position(-90, 240), new Position(-90, 255),
            };
            var b = CalculatorCoefficients.DLYModelVectors(profile);
            var testResult = CalculatorCoefficients.OneCompute(a, b);

            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 4);
        }

        [TestMethod]
        public void OneCompute_CorrectAnswer2()
        {
            var etalonDoubles = new[]
            {
                new[] {0.001461571, 0.002531658, 0.005961292},
                new[] {208.1090946, -0.300610506, -4.488052801},
                new[] {-0.541610203, 206.6792353, 0.105203135},
                new[] {1.449004424, 0.021325467, 210.1447257},
                new[] {0.080629358, 0.018675088, -0.008075668},
                new[] {0.00430093, -0.007925891, -0.008751431},
                new[] {-0.011337979, 0.023571143, -0.019165126},
                new[] {31.63665946, -0.039659279, -0.681579726},
                new[] {-0.084314397, 31.72197103, 0.009375337},
                new[] {0.228726407, 0.002680384, 32.3097742},
                new[] {-0.055641325, -0.043222927, 0.017995221},
                new[] {-0.003435658, -0.070676709, 0.020602841},
                new[] {0.022152818, -0.058667054, -0.042120528}
            };

            var a = new[]
            {
                new[]
                {
                    1, -7.67E-07, -2.63E-06, -3.56E-05, 5.89E-13, 6.94E-12, 1.27E-09, -4.52E-19, -1.83E-17,
                    -4.53E-14, 3.47E-25, 4.81E-23, 1.61E-18
                },
                new[]
                {
                    1, 2.37E-05, 0.009649086, -3.60E-05, 5.61E-10, 9.31E-05, 1.30E-09, 1.33E-14, 8.98E-07,
                    -4.68E-14, 3.14E-19, 8.67E-09, 1.68E-18
                },
                new[]
                {
                    1, 7.63E-05, 0.038612668, -4.47E-05, 5.82E-09, 1.49E-03, 2.00E-09, 4.44E-13, 5.76E-05,
                    -8.93E-14, 3.39E-17, 2.22E-06, 3.99E-18
                },
                new[]
                {
                    1, 0.000193108, 0.077184453, -6.48E-05, 3.73E-08, 5.96E-03, 4.20E-09, 7.20E-12, 4.60E-04,
                    -2.72E-13, 1.39E-15, 3.55E-05, 1.76E-17
                },
                new[]
                {
                    1, 0.000797403, 0.30521211, -0.000161071, 6.36E-07, 9.32E-02, 2.59E-08, 5.07E-10, 2.84E-02,
                    -4.18E-12, 4.04E-13, 8.68E-03, 6.73E-16
                },
                new[]
                {
                    1, 0.001404801, 0.520573429, -0.000259803, 1.97E-06, 2.71E-01, 6.75E-08, 2.77E-09, 1.41E-01,
                    -1.75E-11, 3.89E-12, 7.34E-02, 4.56E-15
                },
                new[]
                {
                    1, 0.001600894, 0.587967654, -0.000296064, 2.56E-06, 3.46E-01, 8.77E-08, 4.10E-09, 2.03E-01,
                    -2.60E-11, 6.57E-12, 1.20E-01, 7.68E-15
                },
                new[]
                {
                    1, -2.20E-05, -0.009656087, -1.85E-05, 4.85E-10, 9.32E-05, 3.42E-10, -1.07E-14, -9.00E-07,
                    -6.33E-15, 2.35E-19, 8.69E-09, 1.17E-19
                },
                new[]
                {
                    1, -0.000119252, -0.038618893, 2.12E-06, 1.42E-08, 1.49E-03, 4.49E-12, -1.70E-12, -5.76E-05,
                    9.52E-18, 2.02E-16, 2.22E-06, 2.02E-23
                },
                new[]
                {
                    1, -0.000209577, -0.077193145, 9.55E-06, 4.39E-08, 5.96E-03, 9.12E-11, -9.21E-12, -4.60E-04,
                    8.72E-16, 1.93E-15, 3.55E-05, 8.33E-21
                },
                new[]
                {
                    1, -0.000816433, -0.30520179, 0.000109574, 6.67E-07, 9.31E-02, 1.20E-08, -5.44E-10,
                    -2.84E-02, 1.32E-12, 4.44E-13, 8.68E-03, 1.44E-16
                },
                new[]
                {
                    1, -0.001424169, -0.520557112, 0.000210772, 2.03E-06, 2.71E-01, 4.44E-08, -2.89E-09,
                    -1.41E-01, 9.36E-12, 4.11E-12, 7.34E-02, 1.97E-15
                },
                new[]
                {
                    1, -0.001626416, -0.587881847, 0.000244156, 2.65E-06, 3.46E-01, 5.96E-08, -4.30E-09,
                    -2.03E-01, 1.46E-11, 7.00E-12, 1.19E-01, 3.55E-15
                },
                new[]
                {
                    1, -1.77E-06, -6.75E-06, -3.17E-05, 3.13E-12, 4.56E-11, 1.00E-09, -5.55E-18, -3.08E-16,
                    -3.17E-14, 9.82E-24, 2.08E-21, 1.00E-18
                },
                new[]
                {
                    1, 7.31E-05, -6.41E-06, -0.009538836, 5.34E-09, 4.11E-11, 9.10E-05, 3.90E-13, -2.63E-16,
                    -8.68E-07, 2.85E-17, 1.69E-21, 8.28E-09
                },
                new[]
                {
                    1, 0.000275691, -2.67E-05, -0.038003519, 7.60E-08, 7.10E-10, 1.44E-03, 2.10E-11, -1.89E-14,
                    -5.49E-05, 5.78E-15, 5.05E-19, 2.09E-06
                },
                new[]
                {
                    1, 0.000528739, -6.87E-06, -0.075940876, 2.80E-07, 4.72E-11, 5.77E-03, 1.48E-10, -3.24E-16,
                    -4.38E-04, 7.82E-14, 2.23E-21, 3.33E-05
                },
                new[]
                {
                    1, 0.002116628, 1.37E-05, -0.30028077, 4.48E-06, 1.88E-10, 9.02E-02, 9.48E-09, 2.57E-15,
                    -2.71E-02, 2.01E-11, 3.53E-20, 8.13E-03
                },
                new[]
                {
                    1, 0.003711756, 3.93E-05, -0.512470842, 1.38E-05, 1.55E-09, 2.63E-01, 5.11E-08, 6.08E-14,
                    -1.35E-01, 1.90E-10, 2.39E-18, 6.90E-02
                },
                new[]
                {
                    1, 0.00424694, 4.87E-05, -0.578963804, 1.80E-05, 2.37E-09, 3.35E-01, 7.66E-08, 1.15E-13,
                    -1.94E-01, 3.25E-10, 5.61E-18, 1.12E-01
                },
                new[]
                {
                    1, -6.60E-05, -5.33E-06, 0.009460878, 4.36E-09, 2.84E-11, 8.95E-05, -2.88E-13, -1.51E-16,
                    8.47E-07, 1.90E-17, 8.06E-22, 8.01E-09
                },
                new[]
                {
                    1, -0.00028236, -2.79E-05, 0.037939182, 7.97E-08, 7.77E-10, 1.44E-03, -2.25E-11, -2.17E-14,
                    5.46E-05, 6.36E-15, 6.04E-19, 2.07E-06
                },
                new[]
                {
                    1, -0.000533014, -2.47E-05, 0.0758865, 2.84E-07, 6.10E-10, 5.76E-03, -1.51E-10, -1.51E-14,
                    4.37E-04, 8.07E-14, 3.72E-19, 3.32E-05
                },
                new[]
                {
                    1, -0.002120594, -5.63E-05, 0.300251616, 4.50E-06, 3.17E-09, 9.02E-02, -9.54E-09, -1.79E-13,
                    2.71E-02, 2.02E-11, 1.01E-17, 8.13E-03
                },
                new[]
                {
                    1, -0.003715347, -8.07E-05, 0.512480555, 1.38E-05, 6.52E-09, 2.63E-01, -5.13E-08, -5.26E-13,
                    1.35E-01, 1.91E-10, 4.25E-17, 6.90E-02
                },
                new[]
                {
                    1, -0.004247001, -8.80E-05, 0.579010458, 1.80E-05, 7.75E-09, 3.35E-01, -7.66E-08, -6.82E-13,
                    1.94E-01, 3.25E-10, 6.00E-17, 1.12E-01
                },
                new[]
                {
                    1, -1.64E-05, -4.27E-06, -3.29E-05, 2.67E-10, 1.82E-11, 1.09E-09, -4.37E-15, -7.78E-17,
                    -3.57E-14, 7.15E-20, 3.32E-22, 1.18E-18
                },
                new[]
                {
                    1, 0.009577092, 9.27E-06, 0.000180485, 9.17E-05, 8.60E-11, 3.26E-08, 8.78E-07, 7.98E-16,
                    5.88E-12, 8.41E-09, 7.40E-21, 1.06E-15
                },
                new[]
                {
                    1, 0.038339363, 3.02E-05, 0.000805347, 1.47E-03, 9.13E-10, 6.49E-07, 5.64E-05, 2.76E-14,
                    5.22E-10, 2.16E-06, 8.33E-19, 4.21E-13
                },
                new[]
                {
                    1, 0.076653385, 9.66E-05, 0.001614648, 5.88E-03, 9.33E-09, 2.61E-06, 4.50E-04, 9.01E-13,
                    4.21E-09, 3.45E-05, 8.70E-17, 6.80E-12
                },
                new[]
                {
                    1, 0.303127617, 0.000422622, 0.006538528, 9.19E-02, 1.79E-07, 4.28E-05, 2.79E-02, 7.55E-11,
                    2.80E-07, 8.44E-03, 3.19E-14, 1.83E-09
                },
                new[]
                {
                    1, 0.517257869, 0.000758608, 0.011465647, 2.68E-01, 5.75E-07, 1.31E-04, 1.38E-01, 4.37E-10,
                    1.51E-06, 7.16E-02, 3.31E-13, 1.73E-08
                },
                new[]
                {
                    1, 0.584345615, 0.000867187, 0.013104758, 3.41E-01, 7.52E-07, 1.72E-04, 2.00E-01, 6.52E-10,
                    2.25E-06, 1.17E-01, 5.66E-13, 2.95E-08
                },
                new[]
                {
                    1, -0.009602396, -5.06E-05, -0.000239611, 9.22E-05, 2.56E-09, 5.74E-08, -8.85E-07,
                    -1.29E-13, -1.38E-11, 8.50E-09, 6.54E-18, 3.30E-15
                },
                new[]
                {
                    1, -0.038357919, -8.38E-05, -0.000835745, 1.47E-03, 7.03E-09, 6.98E-07, -5.64E-05,
                    -5.89E-13, -5.84E-10, 2.16E-06, 4.94E-17, 4.88E-13
                },
                new[]
                {
                    1, -0.076675986, -0.000135944, -0.001674283, 5.88E-03, 1.85E-08, 2.80E-06, -4.51E-04,
                    -2.51E-12, -4.69E-09, 3.46E-05, 3.42E-16, 7.86E-12
                },
                new[]
                {
                    1, -0.303209735, -0.000464816, -0.006592029, 9.19E-02, 2.16E-07, 4.35E-05, -2.79E-02,
                    -1.00E-10, -2.86E-07, 8.45E-03, 4.67E-14, 1.89E-09
                },
                new[]
                {
                    1, -0.5174149, -0.000794452, -0.011517505, 2.68E-01, 6.31E-07, 1.33E-04, -1.39E-01,
                    -5.01E-10, -1.53E-06, 7.17E-02, 3.98E-13, 1.76E-08
                },
                new[]
                {
                    1, -0.58453578, -0.000909136, -0.013159995, 3.42E-01, 8.27E-07, 1.73E-04, -2.00E-01,
                    -7.51E-10, -2.28E-06, 1.17E-01, 6.83E-13, 3.00E-08
                },
            };

            var testResult = CalculatorCoefficients.OneCompute(a, CalculatorCoefficients.DYS_MATRIX);
            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 1);
        }

        [TestMethod]
        public void OneCompute_CorrectDLYAnswer()
        {
            var etalonDoubles = new[]
            {
                new[] {-0.124600573, 0.110606717, 0.038087846},
                new[] {-243.3306627, -0.83659402, 2.260448225},
                new[] {0.272785419, 243.6019699, -0.011742879},
                new[] {1.845029402, 0.196981057, -243.7652119}
            };

            var a = new[]
            {
                new [] {1, -0.000452066, 0.039814162, 0.000171875},
                new [] {1, 0.009969337, 0.038480994, 0.000264918},
                new [] {1, 0.019687299, 0.034483617, 0.000358003},
                new [] {1, 0.028029765, 0.028109651, 0.000432792},
                new [] {1, 0.034423381, 0.019793701, 0.000490356},
                new [] {1, 0.038435419, 0.010096424, 0.000528389},
                new [] {1, 0.039798213, -0.000317583, 0.000537386},
                new [] {1, 0.038415143, -0.010740526, 0.000527058},
                new [] {1, 0.034374317, -0.020463434, 0.000488002},
                new [] {1, 0.02795824, -0.028829068, 0.000428605},
                new [] {1, 0.019606465, -0.035256529, 0.000351188},
                new [] {1, 0.009877411, -0.039314019, 0.000258279},
                new [] {1, -0.000550228, -0.040722055, 0.000165126},
                new [] {1, -0.010973698, -0.039385465, 6.79E-05},
                new [] {1, -0.020689162, -0.035394976, -2.50E-05},
                new [] {1, -0.029035643, -0.029019619, -9.90E-05},
                new [] {1, -0.035432193, -0.02070699, -0.000163649},
                new [] {1, -0.0394531, -0.011005919, -0.000199499},
                new [] {1, -0.04081737, -0.000594827, -0.000219485},
                new [] {1, -0.039428864, 0.00982886, -0.00020703},
                new [] {1, -0.03539049, 0.019548938, -0.000170894},
                new [] {1, -0.02897382, 0.027906429, -0.000112676},
                new [] {1, -0.02061946, 0.034333184, -3.74E-05},
                new [] {1, -0.010893179, 0.038384284, 5.45E-05},
                new [] {1, -0.000464251, 0.039790224, 0.00015177},
                new [] {1, -0.000386523, 0.038410654, 0.010563092},
                new [] {1, -0.00031766, 0.034380694, 0.020263793},
                new [] {1, -0.000264656, 0.027972291, 0.028595969},
                new [] {1, -0.00022716, 0.019632087, 0.034993804},
                new [] {1, -0.000207102, 0.009923333, 0.039012686},
                new [] {1, -0.000207664, -0.000491567, 0.040379949},
                new [] {1, -0.000226466, -0.01090694, 0.039011499},
                new [] {1, -0.000270552, -0.02061409, 0.034992096},
                new [] {1, -0.000328332, -0.028947149, 0.028593458},
                new [] {1, -0.00039776, -0.035339246, 0.020265767},
                new [] {1, -0.000478422, -0.039352715, 0.01056095},
                new [] {1, -0.000559522, -0.040718261, 0.000153122},
                new [] {1, -0.000631528, -0.039339336, -0.010260321},
                new [] {1, -0.000702836, -0.035308948, -0.019964316},
                new [] {1, -0.000760131, -0.028905501, -0.02829559},
                new [] {1, -0.000800593, -0.020566565, -0.034691585},
                new [] {1, -0.000818826, -0.010853297, -0.038719004},
                new [] {1, -0.000819077, -0.000430479, -0.040091577},
                new [] {1, -0.000798028, 0.009989033, -0.038715942},
                new [] {1, -0.000755183, 0.019699752, -0.034699514},
                new [] {1, -0.000699976, 0.028026483, -0.02830682},
                new [] {1, -0.000631565, 0.034419781, -0.019975132},
                new [] {1, -0.000549615, 0.038438519, -0.010263025},
                new [] {1, -0.000207536, -0.000480373, 0.040378441},
                new [] {1, -0.01065052, -0.000512933, 0.038914864},
                new [] {1, -0.020400133, -0.000540317, 0.0348053},
                new [] {1, -0.028798306, -0.000562632, 0.028332027},
                new [] {1, -0.035270772, -0.000581074, 0.019941781},
                new [] {1, -0.039375919, -0.000587308, 0.010197909},
                new [] {1, -0.040824364, -0.000585018, -0.000225395},
                new [] {1, -0.039531869, -0.000574018, -0.010623394},
                new [] {1, -0.03558115, -0.00055124, -0.02029033},
                new [] {1, -0.029233373, -0.000525671, -0.028562676},
                new [] {1, -0.020931916, -0.000491871, -0.034879986},
                new [] {1, -0.011238279, -0.000453035, -0.038813848},
                new [] {1, -0.000815208, -0.000416658, -0.040091679},
                new [] {1, 0.009625598, -0.000384128, -0.038626292},
                new [] {1, 0.01937517, -0.000354878, -0.034513708},
                new [] {1, 0.02776693, -0.000327574, -0.028044064},
                new [] {1, 0.034239797, -0.000317134, -0.019653504},
                new [] {1, 0.038336781, -0.000308891, -0.009912307},
                new [] {1, 0.039794743, -0.000309469, 0.000511775},
                new [] {1, 0.038496103, -0.000324423, 0.010910818},
                new [] {1, 0.034541621, -0.000346873, 0.020578132},
                new [] {1, 0.028197821, -0.000373447, 0.028854877},
                new [] {1, 0.019895722, -0.000411337, 0.035171847},
                new [] {1, 0.010204174, -0.000444345, 0.039104506}
            };

            var profile = new[]
            {
                new Position(), new Position(15), new Position(30), new Position(45), new Position(60),
                new Position(75), new Position(90), new Position(105), new Position(120), new Position(135),
                new Position(150), new Position(165), new Position(180), new Position(195), new Position(210),
                new Position(225), new Position(240), new Position(255), new Position(270), new Position(285),
                new Position(300), new Position(315), new Position(330), new Position(345), new Position(0, 90),
                new Position(15, 90), new Position(30, 90), new Position(45, 90), new Position(60, 90),
                new Position(75, 90), new Position(90, 90), new Position(105, 90), new Position(120, 90),
                new Position(135, 90), new Position(150, 90), new Position(165, 90), new Position(180, 90),
                new Position(195, 90), new Position(210, 90), new Position(225, 90), new Position(240, 90),
                new Position(255, 90), new Position(270, 90), new Position(285, 90), new Position(300, 90),
                new Position(315, 90), new Position(330, 90), new Position(345, 90), new Position(-90, -90),
                new Position(-90, -75), new Position(-90, -60), new Position(-90, -45), new Position(-90, -30),
                new Position(-90, -15), new Position(-90), new Position(-90, 15), new Position(-90, 30),
                new Position(-90, 45), new Position(-90, 60), new Position(-90, 75), new Position(-90, 90),
                new Position(-90, 105), new Position(-90, 120), new Position(-90, 135), new Position(-90, 150),
                new Position(-90, 165), new Position(-90, 180), new Position(-90, 195), new Position(-90, 210),
                new Position(-90, 225), new Position(-90, 240), new Position(-90, 255),
            };
            var b = CalculatorCoefficients.DLYModelVectors(profile);
            var testResult = CalculatorCoefficients.OneCompute(a, b);

            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 3);
        }

        [TestMethod]
        public void OneCompute_CorrectDLYAnswer2()
        {
            var etalonDoubles = new[]
            {
                new[] {-0.101057528, -0.223360534, 0.082067183},
                new[] {-243.8646053, -0.842091821, 2.198750205},
                new[] {0.262766562, 244.141915, -0.064124628},
                new[] {1.853322507, 0.17300186, -244.3929618},
            };

            var a = new[]
            {
                new[] {1, -0.000360302, 0.041100618, 0.000321954},
                new[] {1, 0.010041987, 0.039761046, 0.000422197},
                new[] {1, 0.0197365, 0.0357701, 0.000510082},
                new[] {1, 0.028060342, 0.02940567, 0.000588524},
                new[] {1, 0.034438726, 0.021107, 0.00065637},
                new[] {1, 0.038442213, 0.01143481, 0.000690548},
                new[] {1, 0.039812441, 0.00105145, 0.000702997},
                new[] {1, 0.038427348, -0.009343752, 0.000693415},
                new[] {1, 0.034397434, -0.019048111, 0.000661948},
                new[] {1, 0.027993294, -0.027385616, 0.000601757},
                new[] {1, 0.019659624, -0.033798947, 0.00052975},
                new[] {1, 0.009955498, -0.037850227, 0.00044225},
                new[] {1, -0.000453274, -0.039254369, 0.000345976},
                new[] {1, -0.010861082, -0.037919056, 0.000248805},
                new[] {1, -0.020549103, -0.033942471, 0.000163645},
                new[] {1, -0.028874737, -0.027587131, 8.91E-05},
                new[] {1, -0.035260536, -0.019284334, 3.05E-05},
                new[] {1, -0.039270346, -0.009619186, -1.10E-05},
                new[] {1, -0.040627674, 0.000771397, -2.76E-05},
                new[] {1, -0.039242263, 0.011170444, -1.76E-05},
                new[] {1, -0.035213748, 0.020875984, 1.80E-05},
                new[] {1, -0.028821434, 0.029216719, 7.05E-05},
                new[] {1, -0.020479776, 0.03563229, 0.000146233},
                new[] {1, -0.010776827, 0.03968105, 0.000229071},
                new[] {1, -0.000365361, 0.041079966, 0.000325959},
                new[] {1, -0.000286726, 0.03970339, 0.010706694},
                new[] {1, -0.000220235, 0.035684557, 0.020390388},
                new[] {1, -0.000162281, 0.029290713, 0.028702323},
                new[] {1, -0.000121036, 0.020964489, 0.035081402},
                new[] {1, -0.000102616, 0.011271393, 0.039093326},
                new[] {1, -0.000102253, 0.000873109, 0.040466241},
                new[] {1, -0.000123274, -0.009516739, 0.039094941},
                new[] {1, -0.000163253, -0.019198859, 0.035084002},
                new[] {1, -0.000226311, -0.027514704, 0.028709398},
                new[] {1, -0.000294481, -0.033891792, 0.020402203},
                new[] {1, -0.00037191, -0.037899494, 0.010729085},
                new[] {1, -0.000450827, -0.039260637, 0.00034284},
                new[] {1, -0.000529386, -0.037883146, -0.010041202},
                new[] {1, -0.000596837, -0.033862886, -0.019725063},
                new[] {1, -0.000655996, -0.027480551, -0.028033093},
                new[] {1, -0.00069549, -0.019152304, -0.034416092},
                new[] {1, -0.000714475, -0.009461327, -0.038427472},
                new[] {1, -0.000714708, 0.000933567, -0.039799932},
                new[] {1, -0.00069304, 0.011329404, -0.03843117},
                new[] {1, -0.000656655, 0.021015916, -0.034429394},
                new[] {1, -0.000596871, 0.0293341, -0.028053481},
                new[] {1, -0.000527287, 0.035719924, -0.0197422},
                new[] {1, -0.000445122, 0.03972388, -0.010064744},
                new[] {1, -0.000111545, 0.000888417, 0.040454361},
                new[] {1, -0.01053126, 0.00085723, 0.039002992},
                new[] {1, -0.020262021, 0.000831004, 0.034903078},
                new[] {1, -0.028642866, 0.000801054, 0.028456182},
                new[] {1, -0.035095406, 0.000784358, 0.020081367},
                new[] {1, -0.039185617, 0.000776809, 0.010363624},
                new[] {1, -0.04063188, 0.000778158, -3.60E-05},
                new[] {1, -0.039339879, 0.000785734, -0.010405263},
                new[] {1, -0.035396728, 0.000809287, -0.020047815},
                new[] {1, -0.02906457, 0.000836967, -0.028302544},
                new[] {1, -0.020785354, 0.000872716, -0.034608891},
                new[] {1, -0.011118341, 0.000906181, -0.038532862},
                new[] {1, -0.000717986, 0.000942111, -0.039811523},
                new[] {1, 0.009700676, 0.000974577, -0.038342407},
                new[] {1, 0.019426349, 0.001008402, -0.034249015},
                new[] {1, 0.027813142, 0.00103449, -0.027801913},
                new[] {1, 0.034268188, 0.001051043, -0.019428107},
                new[] {1, 0.038356778, 0.001057929, -0.009712557},
                new[] {1, 0.039803431, 0.001052566, 0.000687222},
                new[] {1, 0.038504908, 0.001042164, 0.011055587},
                new[] {1, 0.034575947, 0.001028071, 0.020703021},
                new[] {1, 0.028239029, 0.000996813, 0.028951883},
                new[] {1, 0.019962067, 0.000963964, 0.035261429},
                new[] {1, 0.010290691, 0.000924988, 0.039179989}
            };

            var profile = new[]
            {
                new Position(), new Position(15), new Position(30), new Position(45), new Position(60),
                new Position(75), new Position(90), new Position(105), new Position(120), new Position(135),
                new Position(150), new Position(165), new Position(180), new Position(195), new Position(210),
                new Position(225), new Position(240), new Position(255), new Position(270), new Position(285),
                new Position(300), new Position(315), new Position(330), new Position(345), new Position(0, 90),
                new Position(15, 90), new Position(30, 90), new Position(45, 90), new Position(60, 90),
                new Position(75, 90), new Position(90, 90), new Position(105, 90), new Position(120, 90),
                new Position(135, 90), new Position(150, 90), new Position(165, 90), new Position(180, 90),
                new Position(195, 90), new Position(210, 90), new Position(225, 90), new Position(240, 90),
                new Position(255, 90), new Position(270, 90), new Position(285, 90), new Position(300, 90),
                new Position(315, 90), new Position(330, 90), new Position(345, 90), new Position(-90, -90),
                new Position(-90, -75), new Position(-90, -60), new Position(-90, -45), new Position(-90, -30),
                new Position(-90, -15), new Position(-90), new Position(-90, 15), new Position(-90, 30),
                new Position(-90, 45), new Position(-90, 60), new Position(-90, 75), new Position(-90, 90),
                new Position(-90, 105), new Position(-90, 120), new Position(-90, 135), new Position(-90, 150),
                new Position(-90, 165), new Position(-90, 180), new Position(-90, 195), new Position(-90, 210),
                new Position(-90, 225), new Position(-90, 240), new Position(-90, 255),
            };
            var b = CalculatorCoefficients.DLYModelVectors(profile);
            var testResult = CalculatorCoefficients.OneCompute(a, b);

            Assert.AreEqual(testResult.Length, etalonDoubles.Length);
            MatrixTests.AssertEquals(testResult, etalonDoubles, 3);
        }
    }
}
